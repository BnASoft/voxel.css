<html>
<head>
<style>

body{
  padding:0px;
  margin:0px;
  
  background:rgb(245,245,245);
  
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.canvas{
  position:absolute;
  top:0px;
  left:0px;
  width:100%;
  height:100%;
  
  perspective:1000px;
  perspective-origin:50% 50%;
}
.scene{
  position:absolute;
  top:50%;
  left:50%;
  
  width:0;
  height:0;
  overflow:visible;
  
  transform-style: preserve-3d;
  transform:rotateY(1deg);
}

.face{
  display:block;
  position:absolute;
  
  outline:none;
  border:none;
  
  margin-left:-50px;
  margin-top:-50px;
  width:100px;
  height:100px;
  
  background:rgb(180,180,180);
}

.cube{
  position:absolute;
  
  transform-style: preserve-3d;
}
.cube .left{
  transform:rotateY(90deg) translate3d(0, 0, 50px);
}
.cube .right{
  transform:rotateY(90deg) translate3d(0, 0, -50px);
}
.cube .front{
  transform:translate3d(0, 0, 50px);
}
.cube .back{
  transform:translate3d(0, 0, -50px);
}
.cube .top{
  transform:rotateX(90deg) translate3d(0, 0, 50px);
}
.cube .bottom{
  transform:rotateX(90deg) translate3d(0, 0, -50px);
}

</style>
</head>
<body>


<div class='canvas'>
  <div class='scene'></div>
</div>


<script>
(function(){
  
  const undefined;
  
  var canvas;
  
  var scene = {
    pan: {
      x: 0,
      y: 0
    },
    rotate: {
      x: 0,
      y: 0,
      z: 0
    },
    zoom: 1
  }
  
  var mouse = {
    start: {
      x: 0,
      y: 0
    },
    current: {
      x: 0,
      y: 0
    },
    lastMove: {
      x: 0,
      y: 0
    }
  }
  
  var world = {
    blockMap: {
      1: ApplyGrassMesh,
      2: ApplyDirtMesh,
      3: ApplyBarkMesh,
      4: ApplyLeavesMesh,
      5: ApplyApplesMesh,
      6: ApplyWaterMesh
    },
    layout: [
      [
        [2, 2, 2, 2, 2],
        [2, 2, 2, 2, 2],
        [2, 6, 6, 2, 2],
        [2, 6, 6, 6, 2],
        [2, 2, 6, 6, 2]
      ],
      [
        [2, 2, 2, 2, 2],
        [2, 2, 2, 2, 2],
        [6, 6, 2, 2, 2],
        [2, 6, 6, 6, 2],
        [2, 2, 2, 6, 6]
      ],
      [
        [2, 2, 2, 2, 1],
        [6, 2, 2, 2, 2],
        [6, 6, 3, 2, 2],
        [2, 6, 6, 6, 2],
        [2, 2, 6, 6, 1]
      ],
      [
        [1, 2, 2, 1, 0],
        [0, 1, 2, 2, 1],
        [0, 0, 3, 1, 1],
        [1, 0, 0, 0, 1],
        [1, 1, 0, 0, 0]
      ],
      [
        [0, 1, 1, 0, 0],
        [0, 0, 1, 1, 0],
        [0, 0, 3, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0]
      ],
      [
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 3, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0]
      ],
      [
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 3, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0]
      ],
      [
        [0, 0, 0, 0, 0],
        [0, 0, 0, 4, 0],
        [0, 0, 3, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0]
      ],
      [
        [0, 0, 0, 0, 0],
        [0, 0, 4, 4, 0],
        [0, 4, 3, 4, 0],
        [0, 4, 4, 0, 0],
        [0, 0, 0, 0, 0]
      ],
      [
        [0, 0, 0, 0, 0],
        [0, 4, 4, 0, 0],
        [0, 4, 4, 4, 0],
        [0, 4, 4, 0, 0],
        [0, 0, 0, 0, 0]
      ],
      [
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 4, 4, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0]
      ]
    ]
  }
  
  function Cube(){
    var self = this;
    
    
    const BLOCK_DIM = 100;
    
    
    var cube;
    var faces = {}
    
    var position = {x:0, y:0, z:0};
    
    
    self.mesh = {
      'setTop': SetTopMesh,
      'setBottom': SetBottomMesh,
      'setFront': SetFrontMesh,
      'setBack': SetBackMesh,
      'setLeft': SetLeftMesh,
      'setRight': SetRightMesh
    }
    
    
    function SetTopMesh(src){
      faces.top.src = src;
    }
    function SetBottomMesh(src){
      faces.bottom.src = src;
    }
    function SetFrontMesh(src){
      faces.front.src = src;
    }
    function SetBackMesh(src){
      faces.back.src = src;
    }
    function SetLeftMesh(src){
      faces.left.src = src;
    }
    function SetRightMesh(src){
      faces.right.src = src;
    }
    
    
    function CreateCube(){
      cube = CreateElem('div', 'cube');
      
      faces.top = CreateElem('img', 'face top');
      faces.bottom = CreateElem('img', 'face bottom');
      
      faces.front = CreateElem('img', 'face front');
      faces.back = CreateElem('img', 'face back');
      
      faces.left = CreateElem('img', 'face left');
      faces.right = CreateElem('img', 'face right');
      
      for(var label in faces){
        var face = faces[label];
        face.src = 'empty.png';
        cube.appendChild(face);
      }
    }
    function CreateElem(type, cls){
      var elem = document.createElement(type);
      elem.setAttribute('class', cls);
      return elem;
    }
    function UpdatePosition(){
      cube.style.transform = 'translate3d('+position.x*BLOCK_DIM+'px, '+-position.y*BLOCK_DIM+'px, '+position.z*BLOCK_DIM+'px)';
    }
    function AppendToScene(){
      canvas.children[0].appendChild(cube);
    }
    
    
    (function Constructor(x, y, z){
      position = {x:x, y:y, z:z};
      CreateCube();
      UpdatePosition();
      AppendToScene();
    }).apply(self, arguments);
  }
  
  function BindCanvas(){
    canvas = document.querySelector('.canvas');
  }
  function UpdateCSSRotations(){
    var cssScene = canvas.querySelector('.scene');
    cssScene.style.transform = 'rotateX('+scene.rotate.x+'rad) rotateY('+scene.rotate.y+'rad) rotateZ('+scene.rotate.z+'rad)';
  }
  
  function BindMouseToScene(){
    canvas.addEventListener('mousedown', MouseDown);
  }
  function MouseDown(event){
    mouse.start.x = event.x;
    mouse.start.y = event.y;
    
    mouse.current.x = event.x;
    mouse.current.y = event.y;
    
    window.addEventListener('mousemove', MouseMove);
    window.addEventListener('mouseup', MouseUp);
  }
  function MouseUp(event){
    window.removeEventListener('mousemove', MouseMove);
    window.removeEventListener('mouseup', MouseUp);
  }
  function MouseMove(event){
    mouse.lastMove.dx = event.x - mouse.current.x;
    mouse.lastMove.dy = event.y - mouse.current.y;
    
    mouse.current.x = event.x;
    mouse.current.y = event.y;
    
    const rotations = 2;
    scene.rotate.y += mouse.lastMove.dx / window.innerWidth * Math.PI*2 * rotations;
    scene.rotate.x -= mouse.lastMove.dy / window.innerHeight * Math.PI*2 * rotations;
    
    UpdateCSSRotations();
  }
  
  window.addEventListener('load', Init);
  function Init(){
    BindCanvas();
    BindMouseToScene();
    
    var height = world.layout.length;
    var width = world.layout[0].length;
    var dy = Math.floor(height / 2);
    var dx = Math.floor(width / 2);
    
    for(var stage=0; stage<world.layout.length; stage++){
      for(var z=0; z<world.layout[stage].length; z++){
        for(var x=0; x<world.layout[stage][z].length; x++){
          var blockMapValue = world.layout[stage][z][x];
          var meshRenderer = world.blockMap[blockMapValue];
          if (meshRenderer !== undefined)
            meshRenderer(new Cube(x-dx, stage-dy, z-dx));
        }
      }
    }
    
  }
  
  
  function ApplyGrassMesh(cube){
    cube.mesh.setFront('res/basic/side.png');
    cube.mesh.setLeft('res/basic/side.png');
    cube.mesh.setBack('res/basic/side.png');
    cube.mesh.setRight('res/basic/side.png');
    cube.mesh.setTop('res/basic/top.png');
    cube.mesh.setBottom('res/basic/bottom.png');
    return cube;
  }
  function ApplyDirtMesh(cube){
    cube.mesh.setFront('res/dirt/main.png');
    cube.mesh.setLeft('res/dirt/main.png');
    cube.mesh.setBack('res/dirt/main.png');
    cube.mesh.setRight('res/dirt/main.png');
    cube.mesh.setTop('res/dirt/main.png');
    cube.mesh.setBottom('res/dirt/main.png');
    return cube;
  }
  function ApplyBarkMesh(cube){
    cube.mesh.setFront('res/tree/bark.png');
    cube.mesh.setLeft('res/tree/bark.png');
    cube.mesh.setBack('res/tree/bark.png');
    cube.mesh.setRight('res/tree/bark.png');
    cube.mesh.setTop('res/tree/cuttrunk.png');
    cube.mesh.setBottom('res/tree/cuttrunk.png');
    return cube;
  }
  function ApplyLeavesMesh(cube){
    cube.mesh.setFront('res/tree/leaves.png');
    cube.mesh.setLeft('res/tree/leaves.png');
    cube.mesh.setBack('res/tree/leaves.png');
    cube.mesh.setRight('res/tree/leaves.png');
    cube.mesh.setTop('res/tree/leaves.png');
    cube.mesh.setBottom('res/tree/leaves.png');
    return cube;
  }
  function ApplyApplesMesh(cube){
    cube.mesh.setFront('res/tree/apples.png');
    cube.mesh.setLeft('res/tree/apples.png');
    cube.mesh.setBack('res/tree/apples.png');
    cube.mesh.setRight('res/tree/apples.png');
    cube.mesh.setTop('res/tree/leaves.png');
    cube.mesh.setBottom('res/tree/leaves.png');
    return cube;
  }
  function ApplyWaterMesh(cube){
    cube.mesh.setFront('res/water/main.png');
    cube.mesh.setLeft('res/water/main.png');
    cube.mesh.setBack('res/water/main.png');
    cube.mesh.setRight('res/water/main.png');
    cube.mesh.setTop('res/water/main.png');
    cube.mesh.setBottom('res/water/main.png');
    return cube;
  }
  
})();
</script>
</body>
</html>