<html>
<head>
<style>

body{
  padding:0px;
  margin:0px;
  
  background:rgb(245,245,245);
  
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  
  background:url(res/background.png);
  background-size:100px 100px;
}

.canvas{
  position:absolute;
  top:0px;
  left:0px;
  width:100%;
  height:100%;
  overflow:hidden;
  
  perspective:1000px;
  perspective-origin:50% 50%;
}
.scene{
  position:absolute;
  top:50%;
  left:50%;
  
  width:0;
  height:0;
  overflow:visible;
  
  transform-style: preserve-3d;
  transform:rotateY(1deg);
}

.face{
  display:block;
  position:absolute;
  
  outline:none;
  border:none;
  
  margin-left:-18px;
  margin-top:-18px;
  width:36px;
  height:36px;
  
  background:rgb(180,180,180);
}

.cube{
  position:absolute;
  
  transform-style:preserve-3d;
}
.cube .anim{
  transform-style:preserve-3d;
}
.cube .anim.down{
  animation:falldown 1000ms linear both;
}
.cube .anim.up{
  animation:fallup 1000ms linear both;
}

.cube .left{
  transform:rotateY(90deg) translate3d(0, 0, 18px);
}
.cube .right{
  transform:rotateY(90deg) translate3d(0, 0, -18px);
}
.cube .front{
  transform:translate3d(0, 0, 18px);
}
.cube .back{
  transform:translate3d(0, 0, -18px);
}
.cube .top{
  transform:rotateX(90deg) translate3d(0, 0, 18px);
}
.cube .bottom{
  transform:rotateX(90deg) translate3d(0, 0, -18px);
}

h1{
  position:absolute;
  
  bottom:0px;
  right:0px;
  
  font-size:80px;
  line-height:80px;
  font-weight:400;
  font-family:'lato';
  
  margin:0px;
  padding:30px;
}
h1 span{
  font-size:50px;
  line-height:50px;
  font-weight:300;
}

@keyframes fallup {
  0% { transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 300, 0, 1); opacity:0; }
  1.3% { transform: matrix3d(1, 0, 0, 0, 0, 3.905, 0, 0, 0, 0, 1, 0, 0, 237.02, 0, 1); }
  2.55% { transform: matrix3d(1, 0, 0, 0, 0, 4.554, 0, 0, 0, 0, 1, 0, 0, 182.798, 0, 1); }
  4.1% { transform: matrix3d(1, 0, 0, 0, 0, 4.025, 0, 0, 0, 0, 1, 0, 0, 125.912, 0, 1); }
  5.71% { transform: matrix3d(1, 0, 0, 0, 0, 3.039, 0, 0, 0, 0, 1, 0, 0, 79.596, 0, 1); }
  8.11% { transform: matrix3d(1, 0, 0, 0, 0, 1.82, 0, 0, 0, 0, 1, 0, 0, 31.647, 0, 1); opacity:1; }
  8.81% { transform: matrix3d(1, 0, 0, 0, 0, 1.581, 0, 0, 0, 0, 1, 0, 0, 21.84, 0, 1); }
  11.96% { transform: matrix3d(1, 0, 0, 0, 0, 1.034, 0, 0, 0, 0, 1, 0, 0, -4.825, 0, 1); }
  12.11% { transform: matrix3d(1, 0, 0, 0, 0, 1.023, 0, 0, 0, 0, 1, 0, 0, -5.53, 0, 1); }
  15.07% { transform: matrix3d(1, 0, 0, 0, 0, 0.947, 0, 0, 0, 0, 1, 0, 0, -12.662, 0, 1); }
  16.12% { transform: matrix3d(1, 0, 0, 0, 0, 0.951, 0, 0, 0, 0, 1, 0, 0, -13.007, 0, 1); }
  27.23% { transform: matrix3d(1, 0, 0, 0, 0, 1.001, 0, 0, 0, 0, 1, 0, 0, -2.352, 0, 1); }
  27.58% { transform: matrix3d(1, 0, 0, 0, 0, 1.001, 0, 0, 0, 0, 1, 0, 0, -2.121, 0, 1); }
  38.34% { transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0.311, 0, 1); }
  40.09% { transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0.291, 0, 1); }
  50% { transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0.048, 0, 1); }
  60.56% { transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, -0.007, 0, 1); }
  82.78% { transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  100% { transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); } 
}
@keyframes falldown {
  0% { transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, -300, 0, 1); opacity:0; }
  1.3% { transform: matrix3d(1, 0, 0, 0, 0, 3.905, 0, 0, 0, 0, 1, 0, 0, -237.02, 0, 1); }
  2.55% { transform: matrix3d(1, 0, 0, 0, 0, 4.554, 0, 0, 0, 0, 1, 0, 0, -182.798, 0, 1); }
  4.1% { transform: matrix3d(1, 0, 0, 0, 0, 4.025, 0, 0, 0, 0, 1, 0, 0, -125.912, 0, 1); }
  5.71% { transform: matrix3d(1, 0, 0, 0, 0, 3.039, 0, 0, 0, 0, 1, 0, 0, -79.596, 0, 1); }
  8.11% { transform: matrix3d(1, 0, 0, 0, 0, 1.82, 0, 0, 0, 0, 1, 0, 0, -31.647, 0, 1); opacity:1; }
  8.81% { transform: matrix3d(1, 0, 0, 0, 0, 1.581, 0, 0, 0, 0, 1, 0, 0, -21.84, 0, 1); }
  11.96% { transform: matrix3d(1, 0, 0, 0, 0, 1.034, 0, 0, 0, 0, 1, 0, 0, 4.825, 0, 1); }
  12.11% { transform: matrix3d(1, 0, 0, 0, 0, 1.023, 0, 0, 0, 0, 1, 0, 0, 5.53, 0, 1); }
  15.07% { transform: matrix3d(1, 0, 0, 0, 0, 0.947, 0, 0, 0, 0, 1, 0, 0, 12.662, 0, 1); }
  16.12% { transform: matrix3d(1, 0, 0, 0, 0, 0.951, 0, 0, 0, 0, 1, 0, 0, 13.007, 0, 1); }
  27.23% { transform: matrix3d(1, 0, 0, 0, 0, 1.001, 0, 0, 0, 0, 1, 0, 0, 2.352, 0, 1); }
  27.58% { transform: matrix3d(1, 0, 0, 0, 0, 1.001, 0, 0, 0, 0, 1, 0, 0, 2.121, 0, 1); }
  38.34% { transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, -0.311, 0, 1); }
  40.09% { transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, -0.291, 0, 1); }
  50% { transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, -0.048, 0, 1); }
  60.56% { transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0.007, 0, 1); }
  82.78% { transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }
  100% { transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); } 
}

.sidebar{
  position:fixed;
  left:0px;
  top:0px;
  
  height:100%;
  overflow:scroll;
  
  background:rgb(245,245,245);
}
.sidebar img{
  display:block;
  margin:20px;
  
  cursor:pointer;
  
  width:60px;
  height:60px;
  
  border-radius:2px;
}

</style>

<link href='https://fonts.googleapis.com/css?family=Lato:400,300' rel='stylesheet' type='text/css'>

</head>
<body>


<div class='sidebar'>
  <img src='res/basic/side.png'/>
  <img src='res/dirt/main.png'/>
  <img src='res/water/main.png'/>
  <img src='res/water/falltop.png'/>
  <img src='res/water/fall.png'/>
  <img src='res/water/crash.png'/>
  <img src='res/tree/leaves.png'/>
  <img src='res/tree/bark.png'/>
  <img src='res/clouds/main.png'/>
</div>

<h1><span>30&deg;</span>RAIN</h1>

<div class='canvas'>
  <div class='scene'></div>
</div>


<script>
(function(){
  
  const undefined;
  
  var canvas;
  
  var scene = {
    pan: {
      x: 0,
      y: 0
    },
    rotate: {
      x: 0,
      y: -Math.PI/4,
      z: 0
    },
    zoom: 1
  }
  
  var mouse = {
    start: {
      x: 0,
      y: 0
    },
    current: {
      x: 0,
      y: 0
    },
    lastMove: {
      x: 0,
      y: 0
    }
  }
  
  var world = {
    blockMap: {
      1: ApplyGrassMesh,
      2: ApplyDirtMesh,
      3: ApplyBarkMesh,
      4: ApplyLeavesMesh,
      5: ApplyWaterFallTopMesh,
      6: ApplyWaterMesh,
      7: ApplyCloudMesh,
      8: ApplyWaterFallMesh,
      9: ApplyWaterFallCrashMesh
    },
    layout: [
      [
        [2, 2, 2, 2, 2],
        [9, 2, 2, 2, 2],
        [9, 6, 6, 2, 2],
        [2, 6, 6, 6, 2],
        [2, 2, 9, 9, 2]
      ],
      [
        [2, 2, 2, 2, 2],
        [8, 2, 2, 2, 2],
        [8, 6, 2, 2, 2],
        [2, 6, 6, 6, 2],
        [2, 2, 8, 8, 2]
      ],
      [
        [2, 2, 2, 2, 1],
        [5, 2, 2, 2, 2],
        [5, 6, 3, 2, 2],
        [2, 6, 6, 6, 2],
        [2, 2, 5, 5, 1]
      ],
      [
        [1, 2, 2, 1, 0],
        [0, 1, 2, 2, 1],
        [0, 0, 3, 1, 1],
        [1, 0, 0, 0, 1],
        [1, 1, 0, 0, 0]
      ],
      [
        [0, 1, 1, 0, 0],
        [0, 0, 1, 1, 0],
        [0, 0, 3, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0]
      ],
      [
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 3, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0]
      ],
      [
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 3, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0]
      ],
      [
        [0, 0, 0, 0, 0],
        [0, 0, 0, 4, 0],
        [0, 0, 3, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0]
      ],
      [
        [0, 0, 0, 0, 0],
        [0, 0, 4, 4, 0],
        [0, 4, 4, 4, 0],
        [0, 4, 4, 0, 0],
        [0, 0, 0, 0, 0]
      ],
      [
        [0, 0, 0, 0, 0],
        [0, 4, 4, 0, 0],
        [0, 4, 4, 4, 0],
        [0, 4, 4, 0, 0],
        [0, 0, 0, 0, 0]
      ],
      [
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 4, 4, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0]
      ],
      [
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0]
      ],
      [
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0]
      ],
      [
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0]
      ],
      [
        [0, 0, 0, 0, 0],
        [0, 0, 7, 7, 0],
        [0, 7, 7, 7, 0],
        [0, 0, 7, 0, 0],
        [0, 0, 0, 0, 0]
      ],
      [
        [0, 0, 7, 7, 7],
        [0, 7, 0, 0, 7],
        [7, 0, 0, 0, 7],
        [0, 7, 7, 7, 0],
        [0, 0, 0, 0, 0]
      ],
      [
        [0, 0, 0, 0, 0],
        [0, 0, 7, 7, 0],
        [0, 7, 7, 7, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0]
      ]
    ]
  }
  
  function Cube(){
    var self = this;
    
    
    const BLOCK_DIM = 36;
    
    
    var cube;
    var faces = {}
    
    var position = {x:0, y:0, z:0};
    
    
    self.mesh = {
      'setTop': SetTopMesh,
      'setBottom': SetBottomMesh,
      'setFront': SetFrontMesh,
      'setBack': SetBackMesh,
      'setLeft': SetLeftMesh,
      'setRight': SetRightMesh
    }
    
    
    function SetTopMesh(src){
      faces.top.src = src;
    }
    function SetBottomMesh(src){
      faces.bottom.src = src;
    }
    function SetFrontMesh(src){
      faces.front.src = src;
    }
    function SetBackMesh(src){
      faces.back.src = src;
    }
    function SetLeftMesh(src){
      faces.left.src = src;
    }
    function SetRightMesh(src){
      faces.right.src = src;
    }
    
    
    function CreateCube(falldown){
      cube = CreateElem('div', 'cube');
      
      var anim = CreateElem('div', 'anim' + (!!falldown ? ' down' : ' up'));
      
      faces.top = CreateElem('img', 'face top');
      faces.bottom = CreateElem('img', 'face bottom');
      
      faces.front = CreateElem('img', 'face front');
      faces.back = CreateElem('img', 'face back');
      
      faces.left = CreateElem('img', 'face left');
      faces.right = CreateElem('img', 'face right');
      
      for(var label in faces){
        var face = faces[label];
        face.src = 'empty.png';
        anim.appendChild(face);
      }
      cube.appendChild(anim);
    }
    function CreateElem(type, cls){
      var elem = document.createElement(type);
      elem.setAttribute('class', cls);
      return elem;
    }
    function UpdatePosition(){
      cube.style.transform = 'translate3d('+position.x*BLOCK_DIM+'px, '+-position.y*BLOCK_DIM+'px, '+position.z*BLOCK_DIM+'px)';
    }
    function AppendToScene(){
      canvas.children[0].appendChild(cube);
    }
    
    
    (function Constructor(x, y, z, down){
      position = {x:x, y:y, z:z};
      CreateCube(down);
      UpdatePosition();
      AppendToScene();
    }).apply(self, arguments);
  }
  
  function BindCanvas(){
    canvas = document.querySelector('.canvas');
  }
  function UpdateCSSRotations(){
    var cssScene = canvas.querySelector('.scene');
    cssScene.style.transform = 'rotateX('+scene.rotate.x+'rad) rotateY('+scene.rotate.y+'rad) rotateZ('+scene.rotate.z+'rad)';
  }
  function UpdateCSSZoom(){
    canvas.style.transform = 'scale('+scene.zoom+', '+scene.zoom+')';
  }
  
  function BindMouseToScene(){
    canvas.addEventListener('mousedown', MouseDown);
    canvas.addEventListener('mousewheel', OnScroll);
  }
  function MouseDown(event){
    mouse.start.x = event.x;
    mouse.start.y = event.y;
    
    mouse.current.x = event.x;
    mouse.current.y = event.y;
    
    window.addEventListener('mousemove', MouseMove);
    window.addEventListener('mouseup', MouseUp);
  }
  function MouseUp(event){
    window.removeEventListener('mousemove', MouseMove);
    window.removeEventListener('mouseup', MouseUp);
  }
  function MouseMove(event){
    mouse.lastMove.dx = event.x - mouse.current.x;
    mouse.lastMove.dy = event.y - mouse.current.y;
    
    mouse.current.x = event.x;
    mouse.current.y = event.y;
    
    const rotations = 2;
    scene.rotate.y += mouse.lastMove.dx / window.innerWidth * Math.PI*2 * rotations;
    scene.rotate.x -= mouse.lastMove.dy / window.innerHeight * Math.PI*2 * rotations;
    
    UpdateCSSRotations();
  }
  function OnScroll(event){
    scene.zoom += event.deltaY / 5000;
    UpdateCSSZoom();
    event.preventDefault();
    return false;
  }
  
  window.addEventListener('load', Init);
  function Init(){
    BindCanvas();
    BindMouseToScene();
    UpdateCSSRotations();
    
    var height = world.layout.length;
    var width = world.layout[0].length;
    var dy = Math.floor(height / 2);
    var dx = Math.floor(width / 2);
    var i = 0;
    
    for(var stage=0; stage<world.layout.length; stage++){
      for(var z=0; z<world.layout[stage].length; z++){
        for(var x=0; x<world.layout[stage][z].length; x++){
          var blockMapValue = world.layout[stage][z][x];
          var meshRenderer = world.blockMap[blockMapValue];
          if (meshRenderer !== undefined)
          (function(x, stage, z, meshRenderer){
            setTimeout(function(){
               meshRenderer(new Cube(x-dx, stage-dy, z-dx));
            }, 40 * i++ + 500);
          })(x, stage, z, meshRenderer);
        }
      }
    }
  }
  
  
  function ApplyGrassMesh(cube){
    cube.mesh.setFront('res/basic/side.png');
    cube.mesh.setLeft('res/basic/side.png');
    cube.mesh.setBack('res/basic/side.png');
    cube.mesh.setRight('res/basic/side.png');
    cube.mesh.setTop('res/basic/top.png');
    cube.mesh.setBottom('res/basic/bottom.png');
    return cube;
  }
  function ApplyDirtMesh(cube){
    cube.mesh.setFront('res/dirt/main.png');
    cube.mesh.setLeft('res/dirt/main.png');
    cube.mesh.setBack('res/dirt/main.png');
    cube.mesh.setRight('res/dirt/main.png');
    cube.mesh.setTop('res/dirt/main.png');
    cube.mesh.setBottom('res/dirt/main.png');
    return cube;
  }
  function ApplyBarkMesh(cube){
    cube.mesh.setFront('res/tree/bark.png');
    cube.mesh.setLeft('res/tree/bark.png');
    cube.mesh.setBack('res/tree/bark.png');
    cube.mesh.setRight('res/tree/bark.png');
    cube.mesh.setTop('res/tree/cuttrunk.png');
    cube.mesh.setBottom('res/tree/cuttrunk.png');
    return cube;
  }
  function ApplyLeavesMesh(cube){
    cube.mesh.setFront('res/tree/leaves.png');
    cube.mesh.setLeft('res/tree/leaves.png');
    cube.mesh.setBack('res/tree/leaves.png');
    cube.mesh.setRight('res/tree/leaves.png');
    cube.mesh.setTop('res/tree/leaves.png');
    cube.mesh.setBottom('res/tree/leaves.png');
    return cube;
  }
  function ApplyApplesMesh(cube){
    cube.mesh.setFront('res/tree/apples.png');
    cube.mesh.setLeft('res/tree/apples.png');
    cube.mesh.setBack('res/tree/apples.png');
    cube.mesh.setRight('res/tree/apples.png');
    cube.mesh.setTop('res/tree/leaves.png');
    cube.mesh.setBottom('res/tree/leaves.png');
    return cube;
  }
  function ApplyWaterMesh(cube){
    cube.mesh.setFront('res/water/main.png');
    cube.mesh.setLeft('res/water/main.png');
    cube.mesh.setBack('res/water/main.png');
    cube.mesh.setRight('res/water/main.png');
    cube.mesh.setTop('res/water/main.png');
    cube.mesh.setBottom('res/water/main.png');
    return cube;
  }
  function ApplyWaterFallTopMesh(cube){
    cube.mesh.setFront('res/water/falltop.png');
    cube.mesh.setLeft('res/water/falltop.png');
    cube.mesh.setBack('res/water/falltop.png');
    cube.mesh.setRight('res/water/falltop.png');
    cube.mesh.setTop('res/water/main.png');
    cube.mesh.setBottom('res/water/main.png');
    return cube;
  }
  function ApplyWaterFallMesh(cube){
    cube.mesh.setFront('res/water/fall.png');
    cube.mesh.setLeft('res/water/fall.png');
    cube.mesh.setBack('res/water/fall.png');
    cube.mesh.setRight('res/water/fall.png');
    cube.mesh.setTop('res/water/main.png');
    cube.mesh.setBottom('res/water/main.png');
    return cube;
  }
  function ApplyWaterFallCrashMesh(cube){
    cube.mesh.setFront('res/water/crash.png');
    cube.mesh.setLeft('res/water/crash.png');
    cube.mesh.setBack('res/water/crash.png');
    cube.mesh.setRight('res/water/crash.png');
    cube.mesh.setTop('res/water/main.png');
    cube.mesh.setBottom('res/water/main.png');
    return cube;
  }
  function ApplyCloudMesh(cube){
    cube.mesh.setFront('res/clouds/main.png');
    cube.mesh.setLeft('res/clouds/main.png');
    cube.mesh.setBack('res/clouds/main.png');
    cube.mesh.setRight('res/clouds/main.png');
    cube.mesh.setTop('res/clouds/main.png');
    cube.mesh.setBottom('res/clouds/main.png');
    return cube;
  }
  
})();
</script>
</body>
</html>