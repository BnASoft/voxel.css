<html>
<head>
<style>

body{
  padding:0px;
  margin:0px;
  
  background:rgb(245,245,245);
  color:rgb(31,31,31);
}

</style>

<title>voxel.css â€¢ Worm Demo</title>

<script src='scripts/Scene.js'></script>
<script src='scripts/SavedWorld.js'></script>
<script src='scripts/Cube.js'></script>
<script src='scripts/SyncedGif.js'></script>
<script src='scripts/meshes.js'></script>
<script src='scripts/defaultworld.js'></script>

<link rel='stylesheet' type='text/css' href='css/voxel.css'></link>

<link href='https://fonts.googleapis.com/css?family=Lato:400,300' rel='stylesheet' type='text/css'></link>

<link rel='stylesheet' href='highlight/styles/solarized-dark.css'>
<script src='highlight/highlight.pack.js'></script>
<script>hljs.initHighlightingOnLoad();</script>

</head>
<body>





<script>
(function(){
  
  const BLOCKDIM = 25;
  
  const WIDTH = 21;
  const HEIGHT = 21;
  
  var scene;
  var player;
  
  var position = {x:0, y:0};
  var lastPressed = function(speed){position.x += speed;};
  
  window.addEventListener('load', Init);
  function Init(){
    CreateScene();
    CreateGameBorder();
    CreatePlayer();
    
    BindKeyboard();
    
    GameCycle();
  }
  
  function GameCycle(){
    setTimeout(GameCycle, 20);
    
    lastPressed(2);
    UpdatePlayerPosition();
    UpdateBoardTilt();
  }
  
  function CreateScene(){
    scene = new Scene();
    scene.attach(document.body);
    scene.disableZoom();
    scene.disableOrbit();
  }
  
  function CreateGameBorder(){
    var dx = (WIDTH - 1) / 2;
    var dy = (HEIGHT - 1) / 2;
    
    for(var x=0; x<WIDTH; x++){
      var cube = new Cube((x-dx)*BLOCKDIM, -dy*BLOCKDIM, 0, BLOCKDIM);
      cube.setMesh(MESHES.dirt);
      cube.addToScene(scene);
      
      var cube = new Cube((x-dx)*BLOCKDIM,  dy*BLOCKDIM, 0, BLOCKDIM);
      cube.setMesh(MESHES.dirt);
      cube.addToScene(scene);
    }
    
    for(var y=1; y<HEIGHT-1; y++){
      var cube = new Cube(-dx*BLOCKDIM, (y-dy)*BLOCKDIM, 0, BLOCKDIM);
      cube.setMesh(MESHES.dirt);
      cube.addToScene(scene);
      
      var cube = new Cube( dx*BLOCKDIM, (y-dy)*BLOCKDIM, 0, BLOCKDIM);
      cube.setMesh(MESHES.dirt);
      cube.addToScene(scene);
    }
  }
  function CreatePlayer(){
    player = new Cube(0, 0, 0, BLOCKDIM);
    player.setMesh(MESHES.water);
    player.addToScene(scene);
  }
  
  function BindKeyboard(){
    window.addEventListener('keydown', OnKeyDown);
  }
  function OnKeyDown(event){
    var charCode = event.which || event.keyCode || event.charCode;
    
    if (charCode === 37) lastPressed = function(speed){position.x -= speed;};
    if (charCode === 38) lastPressed = function(speed){position.y += speed;};
    if (charCode === 39) lastPressed = function(speed){position.x += speed;};
    if (charCode === 40) lastPressed = function(speed){position.y -= speed;};
  }
  
  function UpdatePlayerPosition(){
    player.setPosition(position.x, position.y);
  }
  function UpdateBoardTilt(){
    var xRot = position.x / (WIDTH*BLOCKDIM/2) * Math.PI / 8;
    var yRot = position.y / (WIDTH*BLOCKDIM/2) * Math.PI / 8;
    
    scene.setRotation(yRot, xRot, 0);
  }
  
})();
</script>
</body>
</html>